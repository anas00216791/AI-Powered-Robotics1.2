"use strict";(self.webpackChunkmy_book=self.webpackChunkmy_book||[]).push([[38],{3842:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"module-2-gazebo-unity/chapter-02-unity","title":"Chapter 2: Unity for High-Fidelity Rendering","description":"Introduction","source":"@site/docs/module-2-gazebo-unity/chapter-02-unity.md","sourceDirName":"module-2-gazebo-unity","slug":"/module-2-gazebo-unity/chapter-02-unity","permalink":"/module-2-gazebo-unity/chapter-02-unity","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 1: Gazebo Physics Simulation","permalink":"/module-2-gazebo-unity/chapter-01-gazebo"},"next":{"title":"Chapter 3: Sensor Simulation","permalink":"/module-2-gazebo-unity/chapter-03-sensors"}}');var r=i(4848),o=i(8453);const s={sidebar_position:2},a="Chapter 2: Unity for High-Fidelity Rendering",l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Why Unity for Robotics?",id:"why-unity-for-robotics",level:2},{value:"Advantages of Unity",id:"advantages-of-unity",level:3},{value:"Unity vs Gazebo",id:"unity-vs-gazebo",level:3},{value:"Setting Up Unity for Robotics",id:"setting-up-unity-for-robotics",level:2},{value:"Installation",id:"installation",level:3},{value:"Creating Your First Unity Robotics Project",id:"creating-your-first-unity-robotics-project",level:3},{value:"Unity-ROS 2 Integration",id:"unity-ros-2-integration",level:2},{value:"Installing ROS-TCP Connector",id:"installing-ros-tcp-connector",level:3},{value:"Configuring the Connection",id:"configuring-the-connection",level:3},{value:"Creating a Robot in Unity",id:"creating-a-robot-in-unity",level:2},{value:"Importing a Robot Model",id:"importing-a-robot-model",level:3},{value:"Adding Articulation Bodies",id:"adding-articulation-bodies",level:3},{value:"Building Realistic Environments",id:"building-realistic-environments",level:2},{value:"Using ProBuilder for Level Design",id:"using-probuilder-for-level-design",level:3},{value:"Materials and Lighting",id:"materials-and-lighting",level:3},{value:"Using Asset Store",id:"using-asset-store",level:3},{value:"Simulating Human-Robot Interaction",id:"simulating-human-robot-interaction",level:2},{value:"Adding Humanoid Characters",id:"adding-humanoid-characters",level:3},{value:"Interaction Scenarios",id:"interaction-scenarios",level:3},{value:"Publishing Data to ROS 2",id:"publishing-data-to-ros-2",level:2},{value:"Camera Images",id:"camera-images",level:3},{value:"Robot Joint States",id:"robot-joint-states",level:3},{value:"Subscribing to ROS 2 Commands",id:"subscribing-to-ros-2-commands",level:2},{value:"Receiving Velocity Commands",id:"receiving-velocity-commands",level:3},{value:"Advanced Rendering Techniques",id:"advanced-rendering-techniques",level:2},{value:"Post-Processing for Realism",id:"post-processing-for-realism",level:3},{value:"Dynamic Lighting",id:"dynamic-lighting",level:3},{value:"Performance Optimization",id:"performance-optimization",level:2},{value:"Reducing Draw Calls",id:"reducing-draw-calls",level:3},{value:"Frame Rate Management",id:"frame-rate-management",level:3},{value:"Best Practices for Unity Robotics",id:"best-practices-for-unity-robotics",level:2},{value:"Summary",id:"summary",level:2},{value:"Further Reading",id:"further-reading",level:2}];function d(n){const e={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"chapter-2-unity-for-high-fidelity-rendering",children:"Chapter 2: Unity for High-Fidelity Rendering"})}),"\n",(0,r.jsx)(e.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsx)(e.p,{children:"While Gazebo excels at physics simulation, Unity brings professional-grade rendering capabilities to robotics. Unity is a powerful game engine used to create photorealistic environments, simulate human-robot interactions, and generate synthetic data for training perception models (Juliani et al., 2018)."}),"\n",(0,r.jsx)(e.p,{children:"In this chapter, you'll learn how to use Unity for robotics visualization, integrate it with ROS 2, and create compelling scenarios for testing robot behaviors."}),"\n",(0,r.jsx)(e.h2,{id:"why-unity-for-robotics",children:"Why Unity for Robotics?"}),"\n",(0,r.jsx)(e.h3,{id:"advantages-of-unity",children:"Advantages of Unity"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Photorealistic Rendering"}),": High-quality graphics for perception training"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Asset Ecosystem"}),": Vast library of 3D models, materials, and environments"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Human Animation"}),": Advanced tools for simulating human behaviors"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Cross-Platform"}),": Deploy to Windows, Linux, macOS, mobile, and VR/AR"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Performance"}),": Optimized rendering pipeline with GPU acceleration"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"UI Tools"}),": Easy creation of control interfaces and dashboards"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"unity-vs-gazebo",children:"Unity vs Gazebo"}),"\n",(0,r.jsx)(e.p,{children:"Use Unity when you need:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"High-quality visuals for presentations or videos"}),"\n",(0,r.jsx)(e.li,{children:"Human-robot interaction scenarios"}),"\n",(0,r.jsx)(e.li,{children:"Synthetic image data for training vision models"}),"\n",(0,r.jsx)(e.li,{children:"Consumer-facing demonstrations"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"Use Gazebo when you need:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Precise physics simulation"}),"\n",(0,r.jsx)(e.li,{children:"Traditional ROS workflow"}),"\n",(0,r.jsx)(e.li,{children:"Headless (no-display) simulation on servers"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"setting-up-unity-for-robotics",children:"Setting Up Unity for Robotics"}),"\n",(0,r.jsx)(e.h3,{id:"installation",children:"Installation"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Install Unity Hub"}),": Download from ",(0,r.jsx)(e.a,{href:"https://unity.com/download",children:"https://unity.com/download"})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Install Unity Editor"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Recommended version: Unity 2021.3 LTS or 2022.3 LTS"}),"\n",(0,r.jsx)(e.li,{children:"Include modules: Linux Build Support, Documentation"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Install Required Packages"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# Via Unity Package Manager (in Unity Editor):\n# Window > Package Manager\n\n# Search and install:\n# - Robotics packages (if available)\n# - ProBuilder (for level design)\n# - Cinemachine (for camera control)\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"creating-your-first-unity-robotics-project",children:"Creating Your First Unity Robotics Project"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Open Unity Hub"}),"\n",(0,r.jsx)(e.li,{children:'Click "New Project"'}),"\n",(0,r.jsx)(e.li,{children:'Choose "3D" template'}),"\n",(0,r.jsx)(e.li,{children:'Name it "RoboticsSimulation"'}),"\n",(0,r.jsx)(e.li,{children:'Click "Create"'}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"unity-ros-2-integration",children:"Unity-ROS 2 Integration"}),"\n",(0,r.jsx)(e.h3,{id:"installing-ros-tcp-connector",children:"Installing ROS-TCP Connector"}),"\n",(0,r.jsx)(e.p,{children:"Unity communicates with ROS 2 via TCP/IP using the ROS-TCP connector."}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"In Unity"}),":"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Open Package Manager (Window > Package Manager)"}),"\n",(0,r.jsx)(e.li,{children:'Click "+" > "Add package from git URL"'}),"\n",(0,r.jsxs)(e.li,{children:["Enter: ",(0,r.jsx)(e.code,{children:"https://github.com/Unity-Technologies/ROS-TCP-Connector.git?path=/com.unity.robotics.ros-tcp-connector"})]}),"\n",(0,r.jsx)(e.li,{children:'Click "Add"'}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"In ROS 2 workspace"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"cd ~/ros2_ws/src\ngit clone https://github.com/Unity-Technologies/ROS-TCP-Endpoint\ncd ~/ros2_ws\ncolcon build\nsource install/setup.bash\n"})}),"\n",(0,r.jsx)(e.h3,{id:"configuring-the-connection",children:"Configuring the Connection"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"In Unity"}),":"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Go to Robotics > ROS Settings"}),"\n",(0,r.jsxs)(e.li,{children:["Set ROS IP Address: ",(0,r.jsx)(e.code,{children:"127.0.0.1"})," (localhost)"]}),"\n",(0,r.jsxs)(e.li,{children:["Set ROS Port: ",(0,r.jsx)(e.code,{children:"10000"})]}),"\n",(0,r.jsxs)(e.li,{children:["Set Protocol: ",(0,r.jsx)(e.code,{children:"ROS 2"})]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Launch ROS-TCP Endpoint"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"ros2 run ros_tcp_endpoint default_server_endpoint --ros-args -p ROS_IP:=0.0.0.0\n"})}),"\n",(0,r.jsx)(e.h2,{id:"creating-a-robot-in-unity",children:"Creating a Robot in Unity"}),"\n",(0,r.jsx)(e.h3,{id:"importing-a-robot-model",children:"Importing a Robot Model"}),"\n",(0,r.jsx)(e.p,{children:"Unity supports several 3D formats:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"FBX (recommended for robots)"}),"\n",(0,r.jsx)(e.li,{children:"OBJ"}),"\n",(0,r.jsx)(e.li,{children:"URDF (via URDF Importer package)"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Method 1: Using URDF Importer"})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"Install URDF Importer:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Package Manager > Add from git URL:\nhttps://github.com/Unity-Technologies/URDF-Importer.git?path=/com.unity.robotics.urdf-importer\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"Import URDF:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Assets > Import Robot from URDF\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"Select your URDF file from Module 1"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:'Click "Import"'}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Method 2: Manual Import"})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Export your robot from Blender or CAD software as FBX"}),"\n",(0,r.jsx)(e.li,{children:"Drag FBX file into Unity's Project window"}),"\n",(0,r.jsx)(e.li,{children:"Drag the model from Project to Scene"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"adding-articulation-bodies",children:"Adding Articulation Bodies"}),"\n",(0,r.jsx)(e.p,{children:"Unity's Articulation Body component simulates robot joints:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:'// ArticulationBodyController.cs\nusing UnityEngine;\n\npublic class ArticulationBodyController : MonoBehaviour\n{\n    private ArticulationBody[] articulationBodies;\n\n    void Start()\n    {\n        // Get all articulation bodies in robot\n        articulationBodies = GetComponentsInChildren<ArticulationBody>();\n\n        foreach (var ab in articulationBodies)\n        {\n            Debug.Log($"Joint: {ab.name}, DOF: {ab.dofCount}");\n        }\n    }\n\n    // Move a specific joint\n    public void SetJointPosition(int jointIndex, float position)\n    {\n        if (jointIndex < articulationBodies.Length)\n        {\n            var drive = articulationBodies[jointIndex].xDrive;\n            drive.target = position * Mathf.Rad2Deg; // Convert radians to degrees\n            articulationBodies[jointIndex].xDrive = drive;\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"Attach this script to your robot's root GameObject."}),"\n",(0,r.jsx)(e.h2,{id:"building-realistic-environments",children:"Building Realistic Environments"}),"\n",(0,r.jsx)(e.h3,{id:"using-probuilder-for-level-design",children:"Using ProBuilder for Level Design"}),"\n",(0,r.jsx)(e.p,{children:"ProBuilder allows you to create custom geometry directly in Unity:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Open ProBuilder (Tools > ProBuilder > ProBuilder Window)"}),"\n",(0,r.jsx)(e.li,{children:"Create basic shapes (New Shape button)"}),"\n",(0,r.jsx)(e.li,{children:"Available shapes: Cube, Plane, Stairs, Arch, etc."}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Example: Creating a room"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"1. Create Plane (10x10) for floor\n2. Create 4 Cubes (10x3x0.2) for walls\n3. Position walls around floor perimeter\n4. Add materials and lighting\n"})}),"\n",(0,r.jsx)(e.h3,{id:"materials-and-lighting",children:"Materials and Lighting"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Creating a Material"}),":"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Right-click in Project > Create > Material"}),"\n",(0,r.jsx)(e.li,{children:"Select the material"}),"\n",(0,r.jsx)(e.li,{children:"Choose Shader: Standard or URP/Lit"}),"\n",(0,r.jsxs)(e.li,{children:["Adjust properties:","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Albedo (base color)"}),"\n",(0,r.jsx)(e.li,{children:"Metallic (0 = non-metal, 1 = metal)"}),"\n",(0,r.jsx)(e.li,{children:"Smoothness (0 = rough, 1 = smooth)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Lighting Setup"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:"// Optimal lighting for robotics visualization\n// 1. Directional Light (sun)\n//    - Intensity: 1.0\n//    - Shadow Type: Soft Shadows\n//    - Color: Warm white (255, 244, 214)\n\n// 2. Ambient lighting\n//    Window > Rendering > Lighting\n//    Environment > Source: Skybox\n//    Ambient Intensity: 1.0\n\n// 3. Reflection Probes (for realistic reflections)\n//    GameObject > Light > Reflection Probe\n"})}),"\n",(0,r.jsx)(e.h3,{id:"using-asset-store",children:"Using Asset Store"}),"\n",(0,r.jsx)(e.p,{children:"Unity's Asset Store has thousands of free and paid assets:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Open Asset Store (Window > Asset Store)"}),"\n",(0,r.jsxs)(e.li,{children:["Search for:","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:'"Office environment"'}),"\n",(0,r.jsx)(e.li,{children:'"Warehouse"'}),"\n",(0,r.jsx)(e.li,{children:'"Laboratory"'}),"\n",(0,r.jsx)(e.li,{children:'"Industrial robot"'}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:"Download and import into project"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"simulating-human-robot-interaction",children:"Simulating Human-Robot Interaction"}),"\n",(0,r.jsx)(e.h3,{id:"adding-humanoid-characters",children:"Adding Humanoid Characters"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Method 1: Unity's Character Controller"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:'// SimpleHumanController.cs\nusing UnityEngine;\n\npublic class SimpleHumanController : MonoBehaviour\n{\n    public float moveSpeed = 2.0f;\n    public Transform target; // Robot to interact with\n\n    private Animator animator;\n    private CharacterController controller;\n\n    void Start()\n    {\n        controller = GetComponent<CharacterController>();\n        animator = GetComponent<Animator>();\n    }\n\n    void Update()\n    {\n        // Move toward robot\n        if (target != null)\n        {\n            Vector3 direction = (target.position - transform.position).normalized;\n\n            // Stop when close enough\n            if (Vector3.Distance(transform.position, target.position) > 1.5f)\n            {\n                controller.Move(direction * moveSpeed * Time.deltaTime);\n                animator.SetBool("Walking", true);\n            }\n            else\n            {\n                animator.SetBool("Walking", false);\n                animator.SetTrigger("Wave"); // Interact with robot\n            }\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Method 2: Using Mixamo Characters"})}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["Go to ",(0,r.jsx)(e.a,{href:"https://www.mixamo.com",children:"https://www.mixamo.com"})," (free with Adobe account)"]}),"\n",(0,r.jsx)(e.li,{children:"Select a character"}),"\n",(0,r.jsx)(e.li,{children:"Choose animations (walk, wave, pick up, etc.)"}),"\n",(0,r.jsxs)(e.li,{children:["Download with settings:","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Format: FBX for Unity"}),"\n",(0,r.jsx)(e.li,{children:"Frames per second: 30"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.li,{children:"Import into Unity"}),"\n",(0,r.jsx)(e.li,{children:"Use Animator Controller to manage animations"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"interaction-scenarios",children:"Interaction Scenarios"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"Scenario 1: Handoff Task"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:"// HandoffScenario.cs\nusing UnityEngine;\n\npublic class HandoffScenario : MonoBehaviour\n{\n    public Transform human;\n    public Transform robot;\n    public GameObject objectToHandoff;\n\n    private enum State { Approach, Reach, Handoff, Retract }\n    private State currentState = State.Approach;\n\n    void Update()\n    {\n        switch (currentState)\n        {\n            case State.Approach:\n                // Human walks toward robot\n                MoveHumanToward(robot.position);\n                if (Vector3.Distance(human.position, robot.position) < 1.0f)\n                {\n                    currentState = State.Reach;\n                }\n                break;\n\n            case State.Reach:\n                // Extend arm with object\n                // (Animate arm extension)\n                currentState = State.Handoff;\n                break;\n\n            case State.Handoff:\n                // Transfer object to robot\n                objectToHandoff.transform.SetParent(robot);\n                currentState = State.Retract;\n                break;\n\n            case State.Retract:\n                // Both move away\n                break;\n        }\n    }\n\n    void MoveHumanToward(Vector3 target)\n    {\n        Vector3 direction = (target - human.position).normalized;\n        human.position += direction * 1.0f * Time.deltaTime;\n    }\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"publishing-data-to-ros-2",children:"Publishing Data to ROS 2"}),"\n",(0,r.jsx)(e.h3,{id:"camera-images",children:"Camera Images"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:'// CameraPublisher.cs\nusing UnityEngine;\nusing Unity.Robotics.ROSTCPConnector;\nusing RosMessageTypes.Sensor;\n\npublic class CameraPublisher : MonoBehaviour\n{\n    public Camera camera;\n    public string topicName = "/camera/image_raw";\n    public float publishRate = 10.0f;\n\n    private ROSConnection ros;\n    private RenderTexture renderTexture;\n    private Texture2D texture2D;\n    private float timer;\n\n    void Start()\n    {\n        ros = ROSConnection.GetOrCreateInstance();\n        ros.RegisterPublisher<ImageMsg>(topicName);\n\n        // Create render texture\n        renderTexture = new RenderTexture(640, 480, 24);\n        camera.targetTexture = renderTexture;\n        texture2D = new Texture2D(640, 480, TextureFormat.RGB24, false);\n    }\n\n    void Update()\n    {\n        timer += Time.deltaTime;\n        if (timer >= 1.0f / publishRate)\n        {\n            PublishImage();\n            timer = 0;\n        }\n    }\n\n    void PublishImage()\n    {\n        RenderTexture.active = renderTexture;\n        texture2D.ReadPixels(new Rect(0, 0, 640, 480), 0, 0);\n        texture2D.Apply();\n\n        ImageMsg msg = new ImageMsg\n        {\n            header = new RosMessageTypes.Std.HeaderMsg\n            {\n                stamp = new RosMessageTypes.BuiltinInterfaces.TimeMsg\n                {\n                    sec = (int)Time.time,\n                    nanosec = (uint)((Time.time % 1) * 1e9)\n                }\n            },\n            height = 480,\n            width = 640,\n            encoding = "rgb8",\n            step = 640 * 3,\n            data = texture2D.GetRawTextureData()\n        };\n\n        ros.Publish(topicName, msg);\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"robot-joint-states",children:"Robot Joint States"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:'// JointStatePublisher.cs\nusing UnityEngine;\nusing Unity.Robotics.ROSTCPConnector;\nusing RosMessageTypes.Sensor;\n\npublic class JointStatePublisher : MonoBehaviour\n{\n    public ArticulationBody[] joints;\n    private ROSConnection ros;\n\n    void Start()\n    {\n        ros = ROSConnection.GetOrCreateInstance();\n        ros.RegisterPublisher<JointStateMsg>("/joint_states");\n    }\n\n    void FixedUpdate()\n    {\n        PublishJointStates();\n    }\n\n    void PublishJointStates()\n    {\n        JointStateMsg msg = new JointStateMsg\n        {\n            header = new RosMessageTypes.Std.HeaderMsg\n            {\n                stamp = new RosMessageTypes.BuiltinInterfaces.TimeMsg\n                {\n                    sec = (int)Time.time,\n                    nanosec = (uint)((Time.time % 1) * 1e9)\n                }\n            },\n            name = new string[joints.Length],\n            position = new double[joints.Length],\n            velocity = new double[joints.Length],\n            effort = new double[joints.Length]\n        };\n\n        for (int i = 0; i < joints.Length; i++)\n        {\n            msg.name[i] = joints[i].name;\n            msg.position[i] = joints[i].jointPosition[0] * Mathf.Deg2Rad;\n            msg.velocity[i] = joints[i].jointVelocity[0] * Mathf.Deg2Rad;\n            msg.effort[i] = joints[i].jointForce[0];\n        }\n\n        ros.Publish("/joint_states", msg);\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"subscribing-to-ros-2-commands",children:"Subscribing to ROS 2 Commands"}),"\n",(0,r.jsx)(e.h3,{id:"receiving-velocity-commands",children:"Receiving Velocity Commands"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:'// VelocitySubscriber.cs\nusing UnityEngine;\nusing Unity.Robotics.ROSTCPConnector;\nusing RosMessageTypes.Geometry;\n\npublic class VelocitySubscriber : MonoBehaviour\n{\n    public string topicName = "/cmd_vel";\n    public float speed = 1.0f;\n\n    private ROSConnection ros;\n    private Vector3 linearVelocity;\n    private float angularVelocity;\n\n    void Start()\n    {\n        ros = ROSConnection.GetOrCreateInstance();\n        ros.Subscribe<TwistMsg>(topicName, ReceiveVelocity);\n    }\n\n    void ReceiveVelocity(TwistMsg msg)\n    {\n        linearVelocity = new Vector3(\n            (float)msg.linear.x,\n            (float)msg.linear.z,\n            (float)msg.linear.y\n        );\n        angularVelocity = (float)msg.angular.z;\n    }\n\n    void Update()\n    {\n        // Apply velocity to robot\n        transform.Translate(linearVelocity * speed * Time.deltaTime);\n        transform.Rotate(0, angularVelocity * Mathf.Rad2Deg * Time.deltaTime, 0);\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h2,{id:"advanced-rendering-techniques",children:"Advanced Rendering Techniques"}),"\n",(0,r.jsx)(e.h3,{id:"post-processing-for-realism",children:"Post-Processing for Realism"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Install Post Processing package (Package Manager)"}),"\n",(0,r.jsxs)(e.li,{children:["Create Post-Process Volume:","\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"GameObject > Volume > Global Volume\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["Add effects:","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Bloom (glowing lights)"}),"\n",(0,r.jsx)(e.li,{children:"Ambient Occlusion (contact shadows)"}),"\n",(0,r.jsx)(e.li,{children:"Color Grading (adjust colors)"}),"\n",(0,r.jsx)(e.li,{children:"Depth of Field (focus effects)"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"dynamic-lighting",children:"Dynamic Lighting"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:"// DynamicLighting.cs\nusing UnityEngine;\n\npublic class DynamicLighting : MonoBehaviour\n{\n    public Light directionalLight;\n    public float dayLength = 120.0f; // 2-minute day/night cycle\n\n    void Update()\n    {\n        // Rotate light to simulate sun movement\n        float angle = (Time.time / dayLength) * 360.0f;\n        directionalLight.transform.rotation = Quaternion.Euler(angle - 90, 0, 0);\n\n        // Adjust intensity based on time of day\n        float intensity = Mathf.Max(0, Mathf.Cos(angle * Mathf.Deg2Rad));\n        directionalLight.intensity = intensity;\n    }\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"performance-optimization",children:"Performance Optimization"}),"\n",(0,r.jsx)(e.h3,{id:"reducing-draw-calls",children:"Reducing Draw Calls"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Batch Static Objects"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Select static objects"}),"\n",(0,r.jsx)(e.li,{children:'Check "Static" in Inspector'}),"\n",(0,r.jsx)(e.li,{children:"Unity will batch them automatically"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Use Occlusion Culling"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Window > Rendering > Occlusion Culling\nBake the scene\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Level of Detail (LOD)"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:"// Add LOD Group component\n// Assign different models for different distances:\n// LOD 0: High-poly model (0-50m)\n// LOD 1: Medium-poly model (50-100m)\n// LOD 2: Low-poly model (100m+)\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"frame-rate-management",children:"Frame Rate Management"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-csharp",children:"// FrameRateManager.cs\nusing UnityEngine;\n\npublic class FrameRateManager : MonoBehaviour\n{\n    public int targetFrameRate = 60;\n\n    void Start()\n    {\n        Application.targetFrameRate = targetFrameRate;\n        QualitySettings.vSyncCount = 0; // Disable VSync for consistent timing\n    }\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"best-practices-for-unity-robotics",children:"Best Practices for Unity Robotics"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Use Consistent Units"}),": Unity uses meters by default\u2014match ROS conventions"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Layer Management"}),": Organize objects into layers (Robot, Environment, UI)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Prefab Workflow"}),": Create reusable prefabs for robots, sensors, obstacles"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Version Control"}),": Use Git with .gitignore configured for Unity"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Testing"}),": Build small test scenes before creating large environments"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Documentation"}),": Comment C# scripts explaining robotics-specific behavior"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(e.p,{children:"In this chapter, you learned:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"How to set up Unity for robotics simulation"}),"\n",(0,r.jsx)(e.li,{children:"How to integrate Unity with ROS 2 using TCP connector"}),"\n",(0,r.jsx)(e.li,{children:"How to import and control robot models in Unity"}),"\n",(0,r.jsx)(e.li,{children:"How to create realistic environments and lighting"}),"\n",(0,r.jsx)(e.li,{children:"How to simulate human-robot interactions"}),"\n",(0,r.jsx)(e.li,{children:"How to publish sensor data and subscribe to commands"}),"\n",(0,r.jsx)(e.li,{children:"Performance optimization techniques"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"Unity's strengths in rendering make it ideal for perception training, human-robot interaction studies, and creating compelling demonstrations. Combined with Gazebo's physics accuracy (Chapter 1), you have powerful tools for comprehensive robot testing."}),"\n",(0,r.jsx)(e.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Unity Robotics Hub: ",(0,r.jsx)(e.a,{href:"https://github.com/Unity-Technologies/Unity-Robotics-Hub",children:"https://github.com/Unity-Technologies/Unity-Robotics-Hub"})]}),"\n",(0,r.jsxs)(e.li,{children:["Unity Learn: ",(0,r.jsx)(e.a,{href:"https://learn.unity.com/",children:"https://learn.unity.com/"})]}),"\n",(0,r.jsxs)(e.li,{children:["ROS-TCP Connector: ",(0,r.jsx)(e.a,{href:"https://github.com/Unity-Technologies/ROS-TCP-Connector",children:"https://github.com/Unity-Technologies/ROS-TCP-Connector"})]}),"\n",(0,r.jsxs)(e.li,{children:["Juliani, A., et al. (2018). Unity: A general platform for intelligent agents. ",(0,r.jsx)(e.em,{children:"arXiv preprint arXiv:1809.02627"}),"."]}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Learning Check"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u2713 Set up Unity with ROS 2 integration"}),"\n",(0,r.jsx)(e.li,{children:"\u2713 Import and control robot models"}),"\n",(0,r.jsx)(e.li,{children:"\u2713 Create realistic environments"}),"\n",(0,r.jsx)(e.li,{children:"\u2713 Simulate human-robot interactions"}),"\n",(0,r.jsx)(e.li,{children:"\u2713 Publish and subscribe to ROS 2 topics"}),"\n",(0,r.jsx)(e.li,{children:"\u2713 Optimize Unity scenes for performance"}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},8453:(n,e,i)=>{i.d(e,{R:()=>s,x:()=>a});var t=i(6540);const r={},o=t.createContext(r);function s(n){const e=t.useContext(o);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:s(n.components),t.createElement(o.Provider,{value:e},n.children)}}}]);
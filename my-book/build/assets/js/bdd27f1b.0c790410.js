"use strict";(self.webpackChunkmy_book=self.webpackChunkmy_book||[]).push([[625],{6414:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"module-1-ros2/chapter-02-python","title":"Chapter 2: Python Agents with rclpy","description":"Introduction","source":"@site/docs/module-1-ros2/chapter-02-python.md","sourceDirName":"module-1-ros2","slug":"/module-1-ros2/chapter-02-python","permalink":"/module-1-ros2/chapter-02-python","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 1: ROS 2 Basics - Nodes, Topics, and Services","permalink":"/module-1-ros2/chapter-01-basics"},"next":{"title":"Chapter 3: Humanoid URDF Modeling","permalink":"/module-1-ros2/chapter-03-urdf"}}');var i=s(4848),t=s(8453);const l={sidebar_position:2},o="Chapter 2: Python Agents with rclpy",a={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"ROS 2 Python Workspace Setup",id:"ros-2-python-workspace-setup",level:2},{value:"Environment Setup",id:"environment-setup",level:3},{value:"Verify Installation",id:"verify-installation",level:3},{value:"Your First Node: A Simple Publisher",id:"your-first-node-a-simple-publisher",level:2},{value:"Code: Minimal Publisher",id:"code-minimal-publisher",level:3},{value:"Running the Publisher",id:"running-the-publisher",level:3},{value:"Understanding the Code",id:"understanding-the-code",level:3},{value:"Inspecting the Running Node",id:"inspecting-the-running-node",level:3},{value:"Creating a Subscriber Node",id:"creating-a-subscriber-node",level:2},{value:"Code: Minimal Subscriber",id:"code-minimal-subscriber",level:3},{value:"Running Publisher and Subscriber Together",id:"running-publisher-and-subscriber-together",level:3},{value:"Practical Example: A Robot Velocity Commander",id:"practical-example-a-robot-velocity-commander",level:2},{value:"Code: Velocity Commander",id:"code-velocity-commander",level:3},{value:"Understanding Twist Messages",id:"understanding-twist-messages",level:3},{value:"Implementing a Service",id:"implementing-a-service",level:2},{value:"Code: Service Server",id:"code-service-server",level:3},{value:"Code: Service Client",id:"code-service-client",level:3},{value:"Testing the Service",id:"testing-the-service",level:3},{value:"Best Practices for ROS 2 Python Development",id:"best-practices-for-ros-2-python-development",level:2},{value:"1. Use Class-Based Nodes",id:"1-use-class-based-nodes",level:3},{value:"2. Handle Shutdown Gracefully",id:"2-handle-shutdown-gracefully",level:3},{value:"3. Use Logging Instead of Print",id:"3-use-logging-instead-of-print",level:3},{value:"4. Choose Appropriate Timer Rates",id:"4-choose-appropriate-timer-rates",level:3},{value:"5. Specify Queue Sizes Thoughtfully",id:"5-specify-queue-sizes-thoughtfully",level:3},{value:"6. Use Standard Message Types",id:"6-use-standard-message-types",level:3},{value:"Summary",id:"summary",level:2},{value:"Further Reading",id:"further-reading",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"chapter-2-python-agents-with-rclpy",children:"Chapter 2: Python Agents with rclpy"})}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsx)(n.p,{children:"In Chapter 1, you learned the conceptual foundations of ROS 2: nodes, topics, and services. Now it's time to put that knowledge into practice by writing Python code that creates functional ROS 2 applications."}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"rclpy"})," library is the official Python client library for ROS 2. It provides all the tools you need to create nodes, publish and subscribe to topics, create services, and interact with the ROS 2 ecosystem from Python (ROS 2 Documentation, 2024)."]}),"\n",(0,i.jsx)(n.p,{children:"In this chapter, you'll learn how to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Set up a ROS 2 Python workspace"}),"\n",(0,i.jsx)(n.li,{children:"Create a simple publisher node"}),"\n",(0,i.jsx)(n.li,{children:"Create a subscriber node that receives messages"}),"\n",(0,i.jsx)(n.li,{children:"Implement a service server and client"}),"\n",(0,i.jsx)(n.li,{children:"Follow best practices for ROS 2 Python development"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsx)(n.p,{children:"Before starting this chapter, ensure you have:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ROS 2 Humble or newer"})," installed on your system"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Python 3.10 or newer"})," (included with ROS 2)"]}),"\n",(0,i.jsxs)(n.li,{children:["A ",(0,i.jsx)(n.strong,{children:"text editor or IDE"})," (VS Code, PyCharm, or even nano/vim)"]}),"\n",(0,i.jsx)(n.li,{children:"Completed Chapter 1 or equivalent understanding of ROS 2 concepts"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"ros-2-python-workspace-setup",children:"ROS 2 Python Workspace Setup"}),"\n",(0,i.jsx)(n.p,{children:"While you can run simple ROS 2 Python scripts directly, it's best practice to organize your code in a properly structured ROS 2 package. However, for learning purposes, we'll start with standalone scripts and then show the package structure."}),"\n",(0,i.jsx)(n.h3,{id:"environment-setup",children:"Environment Setup"}),"\n",(0,i.jsx)(n.p,{children:"Every time you open a new terminal to work with ROS 2, you need to source the setup file:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# On Ubuntu/Linux\nsource /opt/ros/humble/setup.bash\n\n# On Windows (adjust version as needed)\ncall C:\\dev\\ros2_humble\\local_setup.bat\n"})}),"\n",(0,i.jsxs)(n.p,{children:["To avoid typing this every time, you can add it to your ",(0,i.jsx)(n.code,{children:"~/.bashrc"})," file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'echo "source /opt/ros/humble/setup.bash" >> ~/.bashrc\n'})}),"\n",(0,i.jsx)(n.h3,{id:"verify-installation",children:"Verify Installation"}),"\n",(0,i.jsx)(n.p,{children:"Check that ROS 2 is properly installed:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 --version\npython3 --version\n"})}),"\n",(0,i.jsx)(n.p,{children:"You should see ROS 2 Humble (or your installed version) and Python 3.10 or newer."}),"\n",(0,i.jsx)(n.h2,{id:"your-first-node-a-simple-publisher",children:"Your First Node: A Simple Publisher"}),"\n",(0,i.jsx)(n.p,{children:"Let's create a node that publishes messages to a topic. We'll build a \"heartbeat\" node that sends a message every second."}),"\n",(0,i.jsx)(n.h3,{id:"code-minimal-publisher",children:"Code: Minimal Publisher"}),"\n",(0,i.jsxs)(n.p,{children:["Create a file named ",(0,i.jsx)(n.code,{children:"simple_publisher.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\n\nclass MinimalPublisher(Node):\n    """\n    A simple publisher node that sends periodic heartbeat messages.\n\n    This node demonstrates the basics of creating a ROS 2 node in Python\n    and publishing messages to a topic.\n    """\n\n    def __init__(self):\n        # Initialize the node with a unique name\n        super().__init__(\'minimal_publisher\')\n\n        # Create a publisher on the \'heartbeat\' topic\n        # Queue size of 10 means we\'ll buffer up to 10 messages\n        self.publisher_ = self.create_publisher(String, \'heartbeat\', 10)\n\n        # Create a timer that calls our callback function every second\n        timer_period = 1.0  # seconds\n        self.timer = self.create_timer(timer_period, self.timer_callback)\n\n        # Counter to track how many messages we\'ve sent\n        self.count = 0\n\n        self.get_logger().info(\'Minimal Publisher node has started\')\n\n    def timer_callback(self):\n        """\n        This function is called every second by the timer.\n        It creates and publishes a message.\n        """\n        msg = String()\n        msg.data = f\'Heartbeat {self.count}\'\n\n        # Publish the message\n        self.publisher_.publish(msg)\n\n        # Log what we published (visible in terminal)\n        self.get_logger().info(f\'Publishing: "{msg.data}"\')\n\n        self.count += 1\n\n\ndef main(args=None):\n    """\n    The main function that runs when the script is executed.\n    """\n    # Initialize the rclpy library\n    rclpy.init(args=args)\n\n    # Create an instance of our node\n    node = MinimalPublisher()\n\n    # Spin the node (keeps it running and processing callbacks)\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        node.get_logger().info(\'Shutting down gracefully\')\n    finally:\n        # Clean up\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"running-the-publisher",children:"Running the Publisher"}),"\n",(0,i.jsx)(n.p,{children:"Make the script executable and run it:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"chmod +x simple_publisher.py\npython3 simple_publisher.py\n"})}),"\n",(0,i.jsx)(n.p,{children:"You should see output like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'[INFO] [minimal_publisher]: Minimal Publisher node has started\n[INFO] [minimal_publisher]: Publishing: "Heartbeat 0"\n[INFO] [minimal_publisher]: Publishing: "Heartbeat 1"\n[INFO] [minimal_publisher]: Publishing: "Heartbeat 2"\n...\n'})}),"\n",(0,i.jsx)(n.h3,{id:"understanding-the-code",children:"Understanding the Code"}),"\n",(0,i.jsx)(n.p,{children:"Let's break down the key components:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Import statements"}),": We import ",(0,i.jsx)(n.code,{children:"rclpy"})," (the ROS 2 Python library), the ",(0,i.jsx)(n.code,{children:"Node"})," base class, and the ",(0,i.jsx)(n.code,{children:"String"})," message type."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Node class"}),": Our ",(0,i.jsx)(n.code,{children:"MinimalPublisher"})," class inherits from ",(0,i.jsx)(n.code,{children:"Node"}),". This gives us access to all ROS 2 node functionality."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:[(0,i.jsx)(n.code,{children:"__init__"})," method"]}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Calls ",(0,i.jsx)(n.code,{children:"super().__init__()"})," with our node name"]}),"\n",(0,i.jsxs)(n.li,{children:["Creates a publisher with ",(0,i.jsx)(n.code,{children:"self.create_publisher()"})]}),"\n",(0,i.jsxs)(n.li,{children:["Sets up a timer with ",(0,i.jsx)(n.code,{children:"self.create_timer()"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Callback function"}),": ",(0,i.jsx)(n.code,{children:"timer_callback()"})," is executed every second by the timer. It creates a message, fills in the data, and publishes it."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Main function"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Initializes rclpy"}),"\n",(0,i.jsx)(n.li,{children:"Creates our node"}),"\n",(0,i.jsxs)(n.li,{children:["Calls ",(0,i.jsx)(n.code,{children:"rclpy.spin()"})," to keep the node running"]}),"\n",(0,i.jsx)(n.li,{children:"Handles cleanup on shutdown"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"inspecting-the-running-node",children:"Inspecting the Running Node"}),"\n",(0,i.jsx)(n.p,{children:"While your publisher is running, open another terminal and try these commands:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Source ROS 2 first\nsource /opt/ros/humble/setup.bash\n\n# List all running nodes\nros2 node list\n\n# See information about our node\nros2 node info /minimal_publisher\n\n# List all active topics\nros2 topic list\n\n# Echo messages being published\nros2 topic echo /heartbeat\n"})}),"\n",(0,i.jsx)(n.p,{children:"This demonstrates that your Python code is a full-fledged part of the ROS 2 ecosystem!"}),"\n",(0,i.jsx)(n.h2,{id:"creating-a-subscriber-node",children:"Creating a Subscriber Node"}),"\n",(0,i.jsxs)(n.p,{children:["Now let's create a node that subscribes to the ",(0,i.jsx)(n.code,{children:"heartbeat"})," topic and receives the messages our publisher sends."]}),"\n",(0,i.jsx)(n.h3,{id:"code-minimal-subscriber",children:"Code: Minimal Subscriber"}),"\n",(0,i.jsxs)(n.p,{children:["Create a file named ",(0,i.jsx)(n.code,{children:"simple_subscriber.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import String\n\n\nclass MinimalSubscriber(Node):\n    \"\"\"\n    A simple subscriber node that listens for heartbeat messages.\n\n    This node demonstrates how to subscribe to a topic and process\n    incoming messages.\n    \"\"\"\n\n    def __init__(self):\n        super().__init__('minimal_subscriber')\n\n        # Create a subscription to the 'heartbeat' topic\n        # The message type must match the publisher (String)\n        # Queue size of 10\n        self.subscription = self.create_subscription(\n            String,\n            'heartbeat',\n            self.listener_callback,\n            10\n        )\n\n        # Prevent unused variable warning\n        # (Python convention for intentionally unused variables)\n        self.subscription\n\n        self.get_logger().info('Minimal Subscriber node has started')\n\n    def listener_callback(self, msg):\n        \"\"\"\n        This function is called every time a message arrives on the topic.\n\n        Args:\n            msg: The message received (String type in this case)\n        \"\"\"\n        self.get_logger().info(f'I heard: \"{msg.data}\"')\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    node = MinimalSubscriber()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        node.get_logger().info('Shutting down gracefully')\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"running-publisher-and-subscriber-together",children:"Running Publisher and Subscriber Together"}),"\n",(0,i.jsx)(n.p,{children:"Now you can see the power of ROS 2's communication system:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"In terminal 1: Run the publisher"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"python3 simple_publisher.py\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"In terminal 2: Run the subscriber"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"python3 simple_subscriber.py\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"You should see the subscriber receiving the messages published by the first node:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'[INFO] [minimal_subscriber]: Minimal Subscriber node has started\n[INFO] [minimal_subscriber]: I heard: "Heartbeat 12"\n[INFO] [minimal_subscriber]: I heard: "Heartbeat 13"\n[INFO] [minimal_subscriber]: I heard: "Heartbeat 14"\n...\n'})}),"\n",(0,i.jsx)(n.p,{children:"The two nodes are communicating through the ROS 2 middleware, and they don't even know about each other directly!"}),"\n",(0,i.jsx)(n.h2,{id:"practical-example-a-robot-velocity-commander",children:"Practical Example: A Robot Velocity Commander"}),"\n",(0,i.jsx)(n.p,{children:"Let's build something more practical: a node that publishes velocity commands for a robot. This is the kind of code you'd use to control a mobile robot."}),"\n",(0,i.jsx)(n.h3,{id:"code-velocity-commander",children:"Code: Velocity Commander"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"velocity_commander.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import Twist\nimport math\n\n\nclass VelocityCommander(Node):\n    \"\"\"\n    Publishes velocity commands to make a robot move in a circle.\n\n    This demonstrates using standard ROS 2 message types for robot control.\n    \"\"\"\n\n    def __init__(self):\n        super().__init__('velocity_commander')\n\n        # Publisher for velocity commands (standard topic name for mobile robots)\n        self.publisher_ = self.create_publisher(Twist, 'cmd_vel', 10)\n\n        # Publish commands at 10 Hz (every 0.1 seconds)\n        timer_period = 0.1\n        self.timer = self.create_timer(timer_period, self.publish_velocity)\n\n        # Keep track of time for creating smooth motions\n        self.time = 0.0\n\n        self.get_logger().info('Velocity Commander started - robot will move in a circle')\n\n    def publish_velocity(self):\n        \"\"\"\n        Publishes velocity commands to make the robot drive in a circle.\n        \"\"\"\n        msg = Twist()\n\n        # Twist message has two Vector3 fields: linear and angular\n        # For a 2D mobile robot, we primarily use:\n        # - linear.x: forward/backward speed\n        # - angular.z: rotational speed\n\n        # Move forward at 0.5 m/s\n        msg.linear.x = 0.5\n        msg.linear.y = 0.0\n        msg.linear.z = 0.0\n\n        # Rotate at 0.5 rad/s (this creates a circular path)\n        msg.angular.x = 0.0\n        msg.angular.y = 0.0\n        msg.angular.z = 0.5\n\n        self.publisher_.publish(msg)\n\n        # Log occasionally (not every message, that would be too much)\n        if int(self.time) % 2 == 0 and self.time < int(self.time) + 0.1:\n            self.get_logger().info(f'Publishing velocity: linear={msg.linear.x:.2f}, angular={msg.angular.z:.2f}')\n\n        self.time += 0.1\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = VelocityCommander()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        # When stopping, publish zero velocity to stop the robot\n        stop_msg = Twist()\n        node.publisher_.publish(stop_msg)\n        node.get_logger().info('Sent stop command, shutting down')\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"understanding-twist-messages",children:"Understanding Twist Messages"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"geometry_msgs/Twist"})," message is the standard way to command velocities for mobile robots. It contains:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Vector3 linear   # Linear velocity (m/s)\n  float64 x      # Forward/backward\n  float64 y      # Left/right (usually 0 for wheeled robots)\n  float64 z      # Up/down (usually 0 for ground robots)\n\nVector3 angular  # Angular velocity (rad/s)\n  float64 x      # Roll rate (usually 0)\n  float64 y      # Pitch rate (usually 0)\n  float64 z      # Yaw rate (rotation in place)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For a differential drive robot (like a TurtleBot), you typically only use ",(0,i.jsx)(n.code,{children:"linear.x"})," and ",(0,i.jsx)(n.code,{children:"angular.z"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"implementing-a-service",children:"Implementing a Service"}),"\n",(0,i.jsx)(n.p,{children:"Services are perfect for operations that need a response. Let's create a simple service that adds two numbers."}),"\n",(0,i.jsx)(n.h3,{id:"code-service-server",children:"Code: Service Server"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"add_two_ints_server.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\n\n\nclass AddTwoIntsServer(Node):\n    \"\"\"\n    A service server that adds two integers and returns the result.\n\n    This demonstrates the request-response pattern in ROS 2.\n    \"\"\"\n\n    def __init__(self):\n        super().__init__('add_two_ints_server')\n\n        # Create a service named 'add_two_ints'\n        # The service type is AddTwoInts (request: two int64, response: one int64)\n        self.srv = self.create_service(\n            AddTwoInts,\n            'add_two_ints',\n            self.add_two_ints_callback\n        )\n\n        self.get_logger().info('Add Two Ints service is ready')\n\n    def add_two_ints_callback(self, request, response):\n        \"\"\"\n        This function is called when a client sends a request.\n\n        Args:\n            request: Contains two int64 values (a and b)\n            response: Object where we set the result\n\n        Returns:\n            The response object with the sum\n        \"\"\"\n        response.sum = request.a + request.b\n\n        self.get_logger().info(\n            f'Received request: {request.a} + {request.b} = {response.sum}'\n        )\n\n        return response\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = AddTwoIntsServer()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        node.get_logger().info('Shutting down service server')\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"code-service-client",children:"Code: Service Client"}),"\n",(0,i.jsxs)(n.p,{children:["Create ",(0,i.jsx)(n.code,{children:"add_two_ints_client.py"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"#!/usr/bin/env python3\n\nimport rclpy\nfrom rclpy.node import Node\nfrom example_interfaces.srv import AddTwoInts\nimport sys\n\n\nclass AddTwoIntsClient(Node):\n    \"\"\"\n    A service client that calls the add_two_ints service.\n    \"\"\"\n\n    def __init__(self):\n        super().__init__('add_two_ints_client')\n\n        # Create a client for the 'add_two_ints' service\n        self.client = self.create_client(AddTwoInts, 'add_two_ints')\n\n        # Wait for the service to be available\n        while not self.client.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Service not available, waiting...')\n\n        self.get_logger().info('Connected to add_two_ints service')\n\n    def send_request(self, a, b):\n        \"\"\"\n        Send a request to add two numbers.\n\n        Args:\n            a: First number\n            b: Second number\n\n        Returns:\n            The sum from the service response\n        \"\"\"\n        # Create a request object\n        request = AddTwoInts.Request()\n        request.a = a\n        request.b = b\n\n        # Call the service asynchronously\n        future = self.client.call_async(request)\n\n        # Wait for the response\n        rclpy.spin_until_future_complete(self, future)\n\n        if future.result() is not None:\n            response = future.result()\n            self.get_logger().info(f'Result: {a} + {b} = {response.sum}')\n            return response.sum\n        else:\n            self.get_logger().error('Service call failed')\n            return None\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    # Get numbers from command line arguments\n    if len(sys.argv) != 3:\n        print('Usage: python3 add_two_ints_client.py <num1> <num2>')\n        return\n\n    try:\n        a = int(sys.argv[1])\n        b = int(sys.argv[2])\n    except ValueError:\n        print('Arguments must be integers')\n        return\n\n    node = AddTwoIntsClient()\n    node.send_request(a, b)\n\n    node.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"testing-the-service",children:"Testing the Service"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"In terminal 1, start the server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"python3 add_two_ints_server.py\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"In terminal 2, call the service:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"python3 add_two_ints_client.py 5 7\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"You should see:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[INFO] [add_two_ints_client]: Connected to add_two_ints service\n[INFO] [add_two_ints_client]: Result: 5 + 7 = 12\n"})}),"\n",(0,i.jsx)(n.p,{children:"And on the server side:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[INFO] [add_two_ints_server]: Received request: 5 + 7 = 12\n"})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices-for-ros-2-python-development",children:"Best Practices for ROS 2 Python Development"}),"\n",(0,i.jsx)(n.p,{children:"As you develop more complex ROS 2 applications, keep these best practices in mind:"}),"\n",(0,i.jsx)(n.h3,{id:"1-use-class-based-nodes",children:"1. Use Class-Based Nodes"}),"\n",(0,i.jsxs)(n.p,{children:["Always structure your nodes as classes that inherit from ",(0,i.jsx)(n.code,{children:"Node"}),". This provides clean encapsulation and access to all node functionality."]}),"\n",(0,i.jsx)(n.h3,{id:"2-handle-shutdown-gracefully",children:"2. Handle Shutdown Gracefully"}),"\n",(0,i.jsxs)(n.p,{children:["Use try-except blocks to catch ",(0,i.jsx)(n.code,{children:"KeyboardInterrupt"})," and clean up properly:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"try:\n    rclpy.spin(node)\nexcept KeyboardInterrupt:\n    node.get_logger().info('Shutting down gracefully')\nfinally:\n    node.destroy_node()\n    rclpy.shutdown()\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-use-logging-instead-of-print",children:"3. Use Logging Instead of Print"}),"\n",(0,i.jsxs)(n.p,{children:["Always use the node's logger instead of ",(0,i.jsx)(n.code,{children:"print()"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Good\nself.get_logger().info('Node started')\nself.get_logger().warn('Low battery')\nself.get_logger().error('Sensor failure')\n\n# Bad\nprint('Node started')\n"})}),"\n",(0,i.jsx)(n.p,{children:"Logging integrates with ROS 2's logging system and can be filtered, redirected, and configured."}),"\n",(0,i.jsx)(n.h3,{id:"4-choose-appropriate-timer-rates",children:"4. Choose Appropriate Timer Rates"}),"\n",(0,i.jsx)(n.p,{children:"For publishers, choose timer rates appropriate to your data:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Sensor data: 10-100 Hz (0.01-0.1 second periods)"}),"\n",(0,i.jsx)(n.li,{children:"Status updates: 1-10 Hz (0.1-1 second periods)"}),"\n",(0,i.jsx)(n.li,{children:"Heartbeats: 1 Hz (1 second period)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"5-specify-queue-sizes-thoughtfully",children:"5. Specify Queue Sizes Thoughtfully"}),"\n",(0,i.jsx)(n.p,{children:"The queue size parameter determines how many messages are buffered:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"For real-time control: small queues (1-10)"}),"\n",(0,i.jsx)(n.li,{children:"For data logging: larger queues (100+)"}),"\n",(0,i.jsx)(n.li,{children:"For occasional updates: 10 is usually fine"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"6-use-standard-message-types",children:"6. Use Standard Message Types"}),"\n",(0,i.jsxs)(n.p,{children:["Whenever possible, use standard message types from packages like ",(0,i.jsx)(n.code,{children:"std_msgs"}),", ",(0,i.jsx)(n.code,{children:"geometry_msgs"}),", and ",(0,i.jsx)(n.code,{children:"sensor_msgs"}),". This makes your nodes interoperable with others in the ROS ecosystem."]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"In this chapter, you learned how to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Set up a ROS 2 Python development environment"}),"\n",(0,i.jsx)(n.li,{children:"Create publisher nodes that send messages to topics"}),"\n",(0,i.jsx)(n.li,{children:"Create subscriber nodes that receive messages"}),"\n",(0,i.jsx)(n.li,{children:"Implement service servers that respond to requests"}),"\n",(0,i.jsx)(n.li,{children:"Create service clients that call services"}),"\n",(0,i.jsxs)(n.li,{children:["Use standard message types like ",(0,i.jsx)(n.code,{children:"String"}),", ",(0,i.jsx)(n.code,{children:"Twist"}),", and ",(0,i.jsx)(n.code,{children:"AddTwoInts"})]}),"\n",(0,i.jsx)(n.li,{children:"Follow best practices for ROS 2 Python development"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"You now have practical experience creating the building blocks of ROS 2 applications. These patterns\u2014publishers, subscribers, services\u2014form the foundation of every ROS 2 robot system."}),"\n",(0,i.jsx)(n.p,{children:"In the next chapter, we'll explore how to model robot structures using URDF, allowing you to describe your robot's physical form and visualize it in simulation tools."}),"\n",(0,i.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["rclpy API Documentation: ",(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/p/rclpy/",children:"https://docs.ros.org/en/humble/p/rclpy/"})]}),"\n",(0,i.jsxs)(n.li,{children:["ROS 2 Python Tutorials: ",(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Publisher-And-Subscriber.html",children:"https://docs.ros.org/en/humble/Tutorials/Beginner-Client-Libraries/Writing-A-Simple-Py-Publisher-And-Subscriber.html"})]}),"\n",(0,i.jsxs)(n.li,{children:["Standard ROS 2 Message Types: ",(0,i.jsx)(n.a,{href:"https://github.com/ros2/common_interfaces",children:"https://github.com/ros2/common_interfaces"})]}),"\n",(0,i.jsxs)(n.li,{children:["Python Best Practices for ROS 2: ",(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Contributing/Code-Style-Language-Versions.html",children:"https://docs.ros.org/en/humble/Contributing/Code-Style-Language-Versions.html"})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Learning Check"}),": Before moving on, make sure you can:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2713 Create a Python node that publishes to a topic"}),"\n",(0,i.jsx)(n.li,{children:"\u2713 Create a Python node that subscribes to a topic"}),"\n",(0,i.jsx)(n.li,{children:"\u2713 Implement a service server and client"}),"\n",(0,i.jsx)(n.li,{children:"\u2713 Use standard message types like Twist"}),"\n",(0,i.jsx)(n.li,{children:"\u2713 Explain the purpose of rclpy.spin()"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var r=s(6540);const i={},t=r.createContext(i);function l(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);
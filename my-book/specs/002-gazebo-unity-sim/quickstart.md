# Quickstart: Module 2 - The Digital Twin (Gazebo & Unity)

**Feature**: 002-gazebo-unity-sim
**Date**: 2025-12-07
**Purpose**: Fast-track guide for developers and content authors working on this module

---

## Overview

This module delivers educational content on robotics simulation, covering:
1. **Gazebo Physics**: Gravity, collisions, environment setup (Gazebo Harmonic + Classic 11)
2. **Unity Rendering**: High-fidelity visualization and human-robot interaction
3. **Sensor Simulation**: LiDAR, depth cameras, and IMUs in both platforms

**Target Audience**: AI/robotics students (undergraduate/graduate level)
**Deliverable**: 3000-5000 word Markdown module with APA citations (≥50% peer-reviewed/official docs)

---

## Prerequisites

### Required Knowledge
- ROS 2 basics (Module 1 completed)
- Markdown syntax
- Basic physics concepts (gravity, force, momentum)
- 3D coordinate systems

### Required Software

**For Content Development**:
- Text editor (VS Code recommended)
- Git
- Docusaurus 3.x (for local preview)
- Python 3.10+ (for chatbot testing)

**For Simulation Examples**:
- **Gazebo**: Gazebo Harmonic (LTS until 2026) or Gazebo Classic 11
  - Installation: https://gazebosim.org/docs/harmonic/install
  - Ubuntu 22.04+ recommended
- **Unity**: Unity 2022 LTS or Unity 6
  - Installation: https://unity.com/download
  - Windows/macOS/Linux supported
  - Requires GPU with OpenGL 4.5+ or Vulkan support
- **ROS 2**: ROS 2 Humble
  - Installation: https://docs.ros.org/en/humble/Installation.html

---

## Project Structure

```
Hackaton raat/
├── specs/002-gazebo-unity-sim/       # THIS FEATURE
│   ├── spec.md                       # Requirements (READ FIRST)
│   ├── plan.md                       # Architecture and design decisions
│   ├── research.md                   # Technology choices and best practices
│   ├── data-model.md                 # Entities and validation rules
│   ├── contracts/                    # API specifications
│   │   ├── chatbot-api.yaml          # RAG chatbot REST API (OpenAPI 3.0)
│   │   └── README.md
│   ├── quickstart.md                 # This file
│   └── tasks.md                      # Generated by /sp.tasks (next step)
│
├── docs/module-02-digital-twin/      # CONTENT OUTPUT
│   ├── index.md                      # Module landing page
│   ├── chapter-01-gazebo-physics.md
│   ├── chapter-02-unity-rendering.md
│   ├── chapter-03-sensor-simulation.md
│   └── assets/                       # Simulation files, diagrams
│       ├── gazebo-worlds/            # .world files for examples
│       ├── unity-scenes/             # Unity scene configs
│       └── diagrams/                 # PNG/SVG diagrams
│
├── simulations/                      # TESTING/VALIDATION
│   ├── gazebo/
│   │   ├── worlds/                   # Test worlds from module examples
│   │   └── models/                   # Robot models (from Module 1)
│   └── unity/
│       ├── scenes/                   # Unity test scenes
│       └── assets/                   # 3D models, textures
│
├── chatbot/                          # RAG CHATBOT (MODULE-AGNOSTIC)
│   ├── src/
│   │   ├── api/                      # FastAPI endpoints
│   │   ├── embeddings/               # Document chunking & embedding
│   │   ├── retrieval/                # Qdrant integration
│   │   └── models/                   # Neon DB schema
│   └── tests/
│       ├── test_embeddings.py
│       ├── test_retrieval.py
│       └── test_accuracy.py          # Validate answers vs. book
│
└── docusaurus/                       # BOOK SITE
    ├── docs/                         # All module content (symlink or copy from docs/)
    ├── src/
    │   ├── components/
    │   │   └── ChatbotWidget.tsx     # Embedded chatbot UI
    │   └── pages/
    └── docusaurus.config.js
```

---

## Quick Start: Content Development

### Step 1: Review Design Documents

Read in this order:
1. `spec.md` - Understand requirements and acceptance criteria
2. `plan.md` - Review architecture and constitution alignment
3. `research.md` - Understand technology choices (Gazebo Harmonic, Unity Robotics Hub, etc.)
4. `data-model.md` - Familiarize with entities (sensors, simulations, citations)

### Step 2: Set Up Local Docusaurus Preview

```bash
cd docusaurus
npm install
npm start
# Visit http://localhost:3000
```

Create module structure:
```bash
mkdir -p docs/module-02-digital-twin/assets/{gazebo-worlds,unity-scenes,diagrams}
touch docs/module-02-digital-twin/index.md
touch docs/module-02-digital-twin/chapter-01-gazebo-physics.md
touch docs/module-02-digital-twin/chapter-02-unity-rendering.md
touch docs/module-02-digital-twin/chapter-03-sensor-simulation.md
```

### Step 3: Content Authoring Workflow

**For Each Chapter**:

1. **Outline**: Break down into sections (reference `data-model.md` → `Chapter` entity)
2. **Research**: Cite official docs and peer-reviewed papers (APA format)
   - Gazebo: https://gazebosim.org/docs/
   - Unity: https://docs.unity3d.com/
   - Google Scholar for robotics simulation papers
3. **Write**: Follow constitution principles (Flesch-Kincaid grade 10-12, define concepts first)
4. **Add Examples**: Create code/simulation examples (see Step 4)
5. **Validate**: Check word count, citation ratio, readability

**Content Template**:
```markdown
# Chapter X: [Title]

## Introduction
[Overview, learning objectives]

## Section 1: [Concept]
[Explanation with examples]

### Code Example: [Title]
\`\`\`xml
<!-- Code here -->
\`\`\`
**Expected Output**: [Description]
**Dependencies**: Gazebo Harmonic 11.0

## Section 2: [Next Concept]
...

## Summary
[Key takeaways]

## References
[Author. (Year). Title. Source. URL]
```

### Step 4: Create Simulation Examples

**Gazebo Example**:
```bash
# Create a world file
cd simulations/gazebo/worlds
cat > basic_physics.world <<EOF
<?xml version="1.0"?>
<sdf version="1.6">
  <world name="basic_physics_demo">
    <physics type="ode">
      <gravity>0 0 -9.81</gravity>
      <max_step_size>0.001</max_step_size>
    </physics>
    <model name="ground_plane">
      <static>true</static>
      <link name="link">
        <collision name="collision">
          <geometry><plane><normal>0 0 1</normal></plane></geometry>
        </collision>
      </link>
    </model>
  </world>
</sdf>
EOF

# Test it
gz sim basic_physics.world  # Harmonic
# OR
gazebo basic_physics.world  # Classic 11

# If it works, copy to docs/module-02-digital-twin/assets/gazebo-worlds/
cp basic_physics.world ../../../docs/module-02-digital-twin/assets/gazebo-worlds/
```

**Unity Example**:
1. Open Unity 2022 LTS
2. Create a new 3D project: "Module02Examples"
3. Install Unity Robotics Hub packages (Package Manager → Add from Git URL):
   - `https://github.com/Unity-Technologies/URDF-Importer.git?path=/com.unity.robotics.urdf-importer`
   - `https://github.com/Unity-Technologies/ROS-TCP-Connector.git?path=/com.unity.robotics.ros-tcp-connector`
4. Create a scene with robot + human avatar
5. Export scene as screenshot/video for docs
6. Save scene config in `simulations/unity/scenes/`

### Step 5: Validation Checklist

Before committing content:
- [ ] Word count: 3000-5000 words for full module
- [ ] Citations: ≥10 unique sources, ≥50% peer-reviewed/official
- [ ] APA format: All citations validated
- [ ] Code examples: All tested and reproducible
- [ ] Simulation examples: `validation_status = "passed"` (see `data-model.md`)
- [ ] Readability: Flesch-Kincaid grade 10-12 (use https://readabilityformulas.com/)
- [ ] No plagiarism: Original writing with proper attribution
- [ ] Assets: All diagrams/worlds/scenes committed to Git

---

## Quick Start: RAG Chatbot Development

### Step 1: Set Up Backend

```bash
cd chatbot

# Create virtual environment
python3 -m venv venv
source venv/bin/activate  # or `venv\Scripts\activate` on Windows

# Install dependencies
pip install fastapi uvicorn qdrant-client psycopg2-binary openai sentence-transformers

# Set environment variables
cat > .env <<EOF
DATABASE_URL=postgresql://user:pass@localhost:5432/bookdb
QDRANT_URL=http://localhost:6333
OPENAI_API_KEY=sk-...  # or use open-source embedding model
EOF

# Run database migrations (create tables from data-model.md)
python src/models/init_db.py

# Start FastAPI server
uvicorn src.api.main:app --reload
# Visit http://localhost:8000/docs for Swagger UI
```

### Step 2: Embed Module Content

```bash
# Chunk and embed docs/module-02-digital-twin/*.md
python src/embeddings/ingest.py \
  --input-dir ../../docs/module-02-digital-twin \
  --collection-name book-content \
  --chunk-size 1024 \
  --overlap 128

# Verify in Qdrant
curl http://localhost:6333/collections/book-content
```

### Step 3: Test Query Endpoint

```bash
curl -X POST http://localhost:8000/v1/query \
  -H "Content-Type: application/json" \
  -d '{
    "query": "How do I set up gravity in Gazebo?",
    "session_id": "test-session"
  }'

# Expected: Answer with sources from chapter-01-gazebo-physics.md
```

### Step 4: Integrate with Docusaurus

```bash
cd docusaurus

# Create chatbot widget component
cat > src/components/ChatbotWidget.tsx <<EOF
import React, { useState } from 'react';

export default function ChatbotWidget() {
  const [query, setQuery] = useState('');
  const [answer, setAnswer] = useState('');
  const [isOpen, setIsOpen] = useState(false);

  const handleQuery = async () => {
    const res = await fetch('http://localhost:8000/v1/query', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ query, session_id: 'docusaurus-session' })
    });
    const data = await res.json();
    setAnswer(data.answer);
  };

  return (
    <div className="chatbot-widget">
      {/* UI implementation */}
    </div>
  );
}
EOF

# Swizzle Root component to inject chatbot globally
npm run swizzle @docusaurus/theme-classic Root -- --wrap

# Edit src/theme/Root.tsx to include <ChatbotWidget />
```

---

## Development Workflow

### 1. Daily Tasks
- Write/edit module content in `docs/module-02-digital-twin/`
- Create/test simulation examples in `simulations/`
- Commit frequently with descriptive messages

### 2. Testing Cycle
- **Content**: Preview in Docusaurus (http://localhost:3000)
- **Simulations**: Run in Gazebo/Unity and verify outputs
- **Chatbot**: Query endpoints and validate answers against content

### 3. Pre-Commit Checklist
- Run linters (markdownlint, prettier)
- Validate OpenAPI contracts: `openapi-generator-cli validate -i specs/002-gazebo-unity-sim/contracts/chatbot-api.yaml`
- Check constitution alignment (see `plan.md` Constitution Check section)

### 4. Ready for Review
- All tasks in `tasks.md` marked as completed
- All validation checks passed (word count, citations, reproducibility)
- PHR (Prompt History Record) created for significant decisions

---

## Common Commands

```bash
# Preview Docusaurus site
cd docusaurus && npm start

# Run Gazebo simulation (Harmonic)
gz sim <world-file.sdf>

# Run Gazebo simulation (Classic 11)
gazebo <world-file.world>

# Start Unity (from command line)
/Applications/Unity/Hub/Editor/2022.3.10f1/Unity.app/Contents/MacOS/Unity -projectPath ./simulations/unity/Module02Examples

# Run chatbot backend
cd chatbot && uvicorn src.api.main:app --reload

# Embed new content
cd chatbot && python src/embeddings/ingest.py --input-dir ../../docs/module-02-digital-twin

# Run tests
cd chatbot && pytest tests/

# Validate word count
wc -w docs/module-02-digital-twin/*.md

# Check readability (requires textstat Python package)
python -c "import textstat; print(textstat.flesch_kincaid_grade(open('docs/module-02-digital-twin/chapter-01-gazebo-physics.md').read()))"
```

---

## Troubleshooting

### Issue: Gazebo won't launch world file
**Solution**:
- Verify SDF syntax: `gz sdf -k <world-file.sdf>`
- Check model paths are correct (use absolute paths or `GAZEBO_MODEL_PATH`)
- Ensure Gazebo Harmonic is installed: `gz sim --version`

### Issue: Unity URDF import fails
**Solution**:
- Verify URDF is valid: `check_urdf <robot.urdf>` (requires `liburdfdom-tools`)
- Check Unity console for specific error messages
- Ensure all mesh files referenced in URDF exist

### Issue: Chatbot returns irrelevant answers
**Solution**:
- Verify content is embedded: `curl http://localhost:6333/collections/book-content`
- Check embedding model matches between ingestion and query
- Increase number of retrieved chunks (top_k parameter)
- Add more context in query or improve chunking strategy

### Issue: Word count too high/low
**Solution**:
- Use `wc -w` to get exact count
- Remove fluff, redundancy, or unnecessary examples
- Add more detail, examples, or explanations if under 3000 words

### Issue: Citation ratio below 50%
**Solution**:
- Search Google Scholar for peer-reviewed robotics simulation papers
- Use official Gazebo/Unity docs more extensively
- Replace blog/tutorial citations with primary sources

---

## Key Resources

**Official Documentation**:
- Gazebo: https://gazebosim.org/docs/
- Unity: https://docs.unity3d.com/
- ROS 2: https://docs.ros.org/en/humble/
- Unity Robotics Hub: https://github.com/Unity-Technologies/Unity-Robotics-Hub

**Research Sources**:
- Google Scholar: https://scholar.google.com/
- IEEE Xplore: https://ieeexplore.ieee.org/
- arXiv (robotics): https://arxiv.org/list/cs.RO/recent

**Tools**:
- Readability calculator: https://readabilityformulas.com/
- APA citation generator: https://www.scribbr.com/apa-citation-generator/
- OpenAPI editor: https://editor.swagger.io/
- Markdown linter: https://github.com/markdownlint/markdownlint

---

## Next Steps

1. **Run `/sp.tasks`**: Generate detailed, testable tasks from this plan
2. **Run `/sp.implement`**: Execute tasks and build the module content
3. **Create ADRs**: Document significant architectural decisions (if any)
4. **Create PHRs**: Record major development conversations for traceability

---

**Last Updated**: 2025-12-07
**Author**: Claude Code (Sonnet 4.5) via `/sp.plan`
